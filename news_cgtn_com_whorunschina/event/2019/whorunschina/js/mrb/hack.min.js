"use strict";function BezierCubicXY(t,a,e,r){this.coords=["x","y"],this.p0=t,this.p1=a,this.p2=e,this.p3=r}function DrawArea(t){this.index=t.index,this.clipArc=d3.arc().innerRadius(0).outerRadius(t.r).startAngle(0).endAngle(0),this.tween=null,this.duration=2e3,this.svg=t.svg,this.width=t.width,this.height=t.height,this.colors=t.colors,this.angle=t.angle,this.radius=t.radius,this.names=t.names,this.area_min_innerRadius=t.area_min_innerRadius,this.area_path_class=t.area_path_class,this.area_path_id_pattern=t.area_path_id_pattern,this.rught_names=["Duty Crime","Criminal Offence","Economic Crime","Duty Dereliction","Economy","Economic Development","Rule of Law","Economic Crime","Economic Dispute","Legal System"],this.tooltip=d3.select("#mrb_tooltip")}function MrbDiagram1(){this.area_path_class="d1-area-path",this.area_path_id_pattern="d1_area_path_",this.svg=$("#diagram1 svg"),this.focus_id="d1_area_path_6"}BezierCubicXY.prototype.xy=function(a){var e=this,r={};return e.coords.forEach(function(t){r[t]=Math.pow(1-a,3)*e.p0[t]+3*Math.pow(1-a,2)*a*e.p1[t]+3*(1-a)*Math.pow(a,2)*e.p2[t]+Math.pow(a,3)*e.p3[t]}),r},DrawArea.prototype.draw=function(){var n=this,t=n.svg.append("g").attr("class",n.area_path_class+" transition").attr("id",n.area_path_id_pattern+n.index).attr("clip-path","url(#clip_area"+n.index+")").attr("transform","translate("+n.width/2+","+n.height/2+")");d3.select("#clip_area"+n.index+"_path").attr("d",n.clipArc);var e=0,a=d3.areaRadial().innerRadius(function(t){e=n.area_min_innerRadius;for(var a=0;a<n.index;a++)e+=n.radius(t[n.names[a]]);return e}).outerRadius(function(t){return e+n.radius(t[n.names[n.index]])}).angle(function(t,a){return n.angle(a)}),r=t.append("path").attr("class","area"+n.index).attr("fill",n.colors[n.index]).attr("d",a),i=n.getData();isMobile.any?r.on("touchend",function(){n.tooltip.html(function(){return'<p class="head mrb-name">'+i.type+'</p>                        <p class="head mrb-num">'+i.name+"</p>"}),n.tooltip.style("display","block");var t=n.tooltip.node().getBoundingClientRect();if(0!==t.width){var a=d3.event.changedTouches[0].pageX,e=d3.event.changedTouches[0].pageY,r=document.body.getBoundingClientRect();a+t.width>r.right&&(a-=a+t.width-r.right),a<0&&(a=0),e<0&&(e=0),n.tooltip.style("left",a+"px").style("top",e+"px")}}):r.on("mouseover",function(){n.tooltip.html(function(){return'<p class="head mrb-name">'+i.type+'</p>                        <p class="head mrb-num">'+i.name+"</p>"}),n.tooltip.style("display","block")}).on("mousemove",function(){var t=n.tooltip.node().getBoundingClientRect();if(0!==t.width){var a=d3.event.pageX,e=d3.event.pageY,r=document.body.getBoundingClientRect();a+t.width>r.right&&(a-=a+t.width-r.right),a<0&&(a=0),e<0&&(e=0),n.tooltip.style("left",a+"px").style("top",e+"px")}}).on("mouseout",function(){n.tooltip.html(""),n.tooltip.style("display","none")})},DrawArea.prototype.getData=function(){var t=this;switch(t.index){case 0:case 1:case 2:case 3:return{type:"SPP report",name:t.rught_names[t.index]};case 4:case 5:return{type:"SPC report",name:t.rught_names[t.index]};case 6:return{type:"SPP report",name:t.rught_names[t.index]};case 7:case 8:case 9:return{type:"SPC report",name:t.rught_names[t.index]}}return t},MrbDiagram1.prototype.draw=function(){var t=this;isMobile.any&&($("#diagram1").css({"margin-top":"160px","margin-left":0}),$("#diagram1 .img-text").css({top:"229px",left:"241px"}),$("#diagram1 .d1-legend").attr("src","./img/d1-legend-m.png"),$("#diagram1 .d1-legend").addClass("m"));var a,e,s=isMobile.any?750:840,c=isMobile.any?650:700,o=160,r=isMobile.any?450:480,d=["#f7435c","#f79d37","#f3de5e","#d83b3c","#a6dde7","#35c8d8","#3c8cc6","#4f82dd","#1a5fae","#ffa7a5"],l=["DutyCrime","CriminalOffence","EconomicCrimeSPP","DutyDereliction","Economy","EconomicDev","RuleLaw","EconomicCrimeSPC","EconomicDispute","LegalSystem"],p=d3.select("#diagram1 svg").datum(Diagram1Data).attr("width",s).attr("height",c),n=d3.max(Diagram1Data,function(t){return t.DutyCrime+t.CriminalOffence+t.EconomicCrimeSPP+t.DutyDereliction+t.Economy+t.EconomicDev+t.RuleLaw+t.EconomicDispute+t.LegalSystem+t.EconomicCrimeSPC}),u=d3.scaleLinear().domain([0,n]).range([0,r-o]),h=d3.scaleLinear().domain([0,Diagram1Data.length]).range([0,2*Math.PI]);return new DrawArea({index:0,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:1,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:2,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:3,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:4,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:5,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:6,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:7,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:8,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),new DrawArea({index:9,svg:p,width:s,height:c,colors:d,angle:h,radius:u,names:l,area_min_innerRadius:o,r:r,area_path_class:t.area_path_class,area_path_id_pattern:t.area_path_id_pattern}).draw(),p.append("g").attr("class","lines").attr("transform","translate("+s/2+","+c/2+")").selectAll("line").data(Diagram1Data).enter().append("line").attr("stroke","#eee").attr("stroke-width",.6).attr("x1",function(t,a){return o*Math.sin(h(a))}).attr("y1",function(t,a){return-1*o*Math.cos(h(a))}).attr("x2",function(t,a){return o*Math.sin(h(a))}).attr("y2",function(t,a){return-1*o*Math.cos(h(a))}).transition().duration(1e3).attr("x2",function(t,a){return(u(t.DutyCrime+t.CriminalOffence+t.EconomicCrimeSPP+t.DutyDereliction+t.Economy+t.EconomicDev+t.RuleLaw+t.EconomicDispute+t.LegalSystem+t.EconomicCrimeSPC)+o)*Math.sin(h(a))}).attr("y2",function(t,a){return-1*(u(t.DutyCrime+t.CriminalOffence+t.EconomicCrimeSPP+t.DutyDereliction+t.Economy+t.EconomicDev+t.RuleLaw+t.EconomicDispute+t.LegalSystem+t.EconomicCrimeSPC)+o)*Math.cos(h(a))}),function(){for(var t=p.append("g").attr("class","dots").attr("transform","translate("+s/2+","+c/2+")"),a=0;a<Diagram1Data.length;a++)for(var e=Diagram1Data[a],r=0;r<10;r++){for(var n=o,i=0;i<=r;i++)n+=u(e[l[i]]);t.append("circle").attr("r",2).attr("fill",d[r]).attr("stroke","#fff").attr("stroke-width",.5).attr("cx",function(){return(n+500)*Math.sin(h(a))}).attr("cy",function(){return-1*(n+500)*Math.cos(h(a))}).transition().duration(1e3).delay(function(){return 50*r}).attr("cx",function(){return n*Math.sin(h(a))}).attr("cy",function(){return-1*n*Math.cos(h(a))})}}(),a=p.append("g").attr("class","info").attr("transform","translate("+s/2+","+c/2+")"),e=d3.arc().innerRadius(150).outerRadius(152).startAngle(0).endAngle(Math.PI/2),a.append("path").attr("fill","#6f7071").attr("d",function(){return e.endAngle(2*Math.PI/40*39),e()}),a.append("path").attr("fill","#464748").attr("d",function(){return e.innerRadius(140),e.outerRadius(145),e.endAngle(2*Math.PI),e()}),a.selectAll("g").data(Diagram1Data).enter().append("g").attr("transform",function(t,a){return"rotate("+9*a+") translate(150, 0)"}).append("line").attr("x2",-3).attr("stroke","#c5c6c7"),t},MrbDiagram1.prototype.startAnimate=function(){var a=d3.arc().innerRadius(0).outerRadius(480).startAngle(0).endAngle(0);return d3.selectAll(".area-path").transition().duration(1500).delay(function(t,a){return 150*a+1500}).attrTween("d",function(){return function(t){return a.endAngle(2*Math.PI*t)()}}),setTimeout(function(){},4e3),this},MrbDiagram1.prototype.stopAnimate=function(){d3.selectAll(".area-path").interrupt()},MrbDiagram1.prototype.focusRuleLaw=function(){var e=this;return e.svg.find("."+e.area_path_class).each(function(t,a){$(a).attr("id")!==e.focus_id&&$(a).css("opacity",.1)}),e},MrbDiagram1.prototype.deFocusRuleLaw=function(){return this.svg.find("."+this.area_path_class).css("opacity",1),this},MrbDiagram1.prototype.hide=function(){};var mrb_diagram_1=new MrbDiagram1;function MrbDiagram2(){this.svg=d3.select("#diagram2 svg"),this.width=isMobile.any?700:880,this.height=isMobile.any?800:658,this.year_w=85,this.max_circle_r=65,this.year_y_scale=d3.scaleLinear().domain([0,4]).range([0,this.height]),this.line_y_scale=d3.scaleLinear().domain([1,10]).range([this.max_circle_r/2,this.height-this.max_circle_r/2]),this.left_line_x=this.width/2-this.year_w/2,this.right_line_x=this.left_line_x+this.year_w,this.spp_circle_x=this.max_circle_r,this.spc_circle_x=this.width-this.max_circle_r,this.circle_scale=d3.scaleLinear().domain([0,d3.max(Diagram2Data,function(t){return t.num})]).range([10,this.max_circle_r]),this.spp_line_colors={"80s":"#dceef1","90s":"#8dcfe6","20s":"#4962da"},this.spc_line_colors={"80s":"#f4e4ce","90s":"#fc7c52","20s":"#ff2047"},this.paths={},this.tween=null,this.d2_spc_txt=$("#d2_spc_txt"),this.d2_spp_txt=$("#d2_spp_txt")}MrbDiagram2.prototype.draw=function(){var e=this;isMobile.any&&($("#diagram2").css({width:"750px",height:"800px","margin-top":"267px"}),$("#diagram2 .spp-txt").css({left:2*e.max_circle_r+"px",height:"800px"}),$("#diagram2 .spc-txt").css({right:2*e.max_circle_r+"px",height:"800px"}),$("#diagram2 .spp-txt p").css({"text-align":"left"}),$("#diagram2 .spc-txt p").css({"text-align":"right"}),$("#diagram2 p").css({height:"80px","line-height":"1.2em","font-size":"18px","padding-top":"1.2em",color:"#666"})),e.svg.attr("width",e.width).attr("height",e.height);var t=e.svg.append("g").attr("class","d2-centries").selectAll("g").data(["1980s","1990s","2000s"]).enter().append("g").attr("transform",function(t,a){return"translate("+e.width/2+","+e.year_y_scale(a+1)+")"});t.append("rect").attr("transform",function(t,a){return"translate("+-1*e.year_w/2+","+-1*e.year_w/2+")"}).attr("width",e.year_w).attr("height",e.year_w).attr("fill",function(t,a){return"url(#d2_fill_"+a+")"}),t.append("text").attr("text-anchor","middle").attr("fill","#fff").style("font-size",24).attr("y",8).text(function(t){return t});for(var a=d3.linkHorizontal(),r=["Public security","Conflict","Corruption and bribery","Smuggling","Supervision","Crime","The people","Work-related crime","Legitimate rights and interests","Impartial law enforcement"],n=["Public security","Conflict","Maritime affairs","Legitimate rights and interests","Criminal","Legal person","Judicial justice","Reform","Supervision","Intellectual property rights"],i=(e.svg.append("g").attr("id","d2_lines").selectAll("path").data(Diagram2Data).enter().append("path").attr("id",function(t){return"d2_path_"+t.id}).attr("class","d2-link").attr("data-d2name",function(t,a){return t.type+t.name}).attr("stroke",function(t){return"spp"==t.type?e.spp_line_colors[t.centry]:e.spc_line_colors[t.centry]}).attr("stroke-width",2).attr("fill","none").attr("d",function(t){if(0<t.num)if("spp"==t.type)switch(t.centry){case"80s":return a({source:[e.left_line_x,e.year_y_scale(1)],target:[e.spp_circle_x,e.line_y_scale(r.indexOf(t.name)+1)]});case"90s":return a({source:[e.left_line_x,e.year_y_scale(2)],target:[e.spp_circle_x,e.line_y_scale(r.indexOf(t.name)+1)]});case"20s":return a({source:[e.left_line_x,e.year_y_scale(3)],target:[e.spp_circle_x,e.line_y_scale(r.indexOf(t.name)+1)]})}else switch(t.centry){case"80s":return a({source:[e.right_line_x,e.year_y_scale(1)],target:[e.spc_circle_x,e.line_y_scale(n.indexOf(t.name)+1)]});case"90s":return a({source:[e.right_line_x,e.year_y_scale(2)],target:[e.spc_circle_x,e.line_y_scale(n.indexOf(t.name)+1)]});case"20s":return a({source:[e.right_line_x,e.year_y_scale(3)],target:[e.spc_circle_x,e.line_y_scale(n.indexOf(t.name)+1)]})}}).attr("data-length",function(t){return this.getTotalLength()}).attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return 1*this.getTotalLength()}),e.svg.append("g").attr("id","d2_circles").selectAll("circle").data(Diagram2Data).enter().append("circle").attr("data-path",function(t){return"d2_path_"+t.id}).attr("data-d2name",function(t,a){return t.type+t.name}).attr("class","d2-circle").attr("id",function(t){return"d2_circle_"+t.id}).attr("fill",function(t){if(0<t.num)return"spp"==t.type?e.spp_line_colors[t.centry]:e.spc_line_colors[t.centry]}).attr("cx",function(t){if(0<t.num)return"spp"==t.type?e.left_line_x:e.right_line_x}).attr("cy",function(t){if(0<t.num)switch(t.centry){case"80s":return e.year_y_scale(1);case"90s":return e.year_y_scale(2);case"20s":return e.year_y_scale(3)}}).attr("r",function(t){return 0}).attr("data-r",function(t){return e.circle_scale(t.num)}).attr("data-cx",function(t){if(0<t.num)return"spp"==t.type?e.spp_circle_x:e.spc_circle_x}).attr("data-cy",function(t){if(0<t.num)return"spp"==t.type?e.line_y_scale(r.indexOf(t.name)+1):e.line_y_scale(n.indexOf(t.name)+1)}).style("opacity",.7),0);i<50;i++){var s=$("#d2_path_unique"+i).attr("d").replace(/C/,",").slice(1).split(",");e.paths["d2_path_unique"+i]=new BezierCubicXY({x:s[0],y:s[1]},{x:s[2],y:s[3]},{x:s[4],y:s[5]},{x:s[6],y:s[7]})}return e},MrbDiagram2.prototype.startAnimate=function(){var t=this;return t.tween=new TWEEN.Tween({scale:0}).to({scale:1},2e3).easing(TWEEN.Easing.Exponential.Out).onUpdate(function(e){d3.selectAll("#d2_circles circle").attr("r",function(){var t=$("#"+this.getAttribute("data-path")),a=t.data("length");return t.attr("stroke-dashoffset",a*(1-e.scale)),parseInt(this.getAttribute("data-r"))*e.scale}).attr("cx",function(){return t.paths[this.getAttribute("data-path")].xy(e.scale).x}).attr("cy",function(){return t.paths[this.getAttribute("data-path")].xy(e.scale).y})}).start(),t},MrbDiagram2.prototype.focusSPP=function(){return this.d2_spc_txt.find("p").css("opacity",.1),this.d2_spp_txt.find("p").css("opacity",.1),$("#diagram2 .d2-circle").css("opacity",.1),$("#diagram2 .d2-link").css("opacity",.1),$('#diagram2 [data-d2name="sppSupervision"]').css("opacity",.7),$('#diagram2 [data-d2name="sppCrime"]').css("opacity",.7),$('#diagram2 [data-d2name="sppWork-related crime"]').css("opacity",.7),this},MrbDiagram2.prototype.deFocusSPP=function(){return this.d2_spc_txt.find("p").css("opacity",1),this.d2_spp_txt.find("p").css("opacity",1),$("#diagram2 .d2-circle").css("opacity",.7),$("#diagram2 .d2-link").css("opacity",.7),this},MrbDiagram2.prototype.focusSPC=function(){return this.d2_spc_txt.find("p").css("opacity",.1),this.d2_spp_txt.find("p").css("opacity",.1),$("#diagram2 .d2-circle").css("opacity",.1),$("#diagram2 .d2-link").css("opacity",.1),$('#diagram2 [data-d2name="spcReform"]').css("opacity",.7),$('#diagram2 [data-d2name="spcSupervision"]').css("opacity",.7),$('#diagram2 [data-d2name="spcIntellectual property rights"]').css("opacity",.7),this},MrbDiagram2.prototype.deFocusSPC=function(){return this.d2_spc_txt.find("p").css("opacity",.7),this.d2_spp_txt.find("p").css("opacity",.7),$("#diagram2 .d2-circle").css("opacity",.7),$("#diagram2 .d2-link").css("opacity",.7),this};var mrb_diagram_2=new MrbDiagram2;function MrbDiagram3(){this.width=isMobile.any?700:1180,this.height=isMobile.any?1134:700,this.svg=d3.select("#diagram3 svg").attr("width",this.width).attr("height",this.height),this.data_length=Diagram3Data.children.length,this.fz=16,this.fz_max=32,this.fz_min=12,this.duration=600,this.duration_delay=50,this.tooltip=d3.select("#mrb_tooltip"),this.scale_color=d3.scaleLinear().domain([0,this.data_length]).range([.7,.3])}MrbDiagram3.prototype.draw=function(){var c=this;isMobile.any?$("#diagram3").css("margin","100px 0 0 25px"):$("#diagram3").css("margin","50px 0 0 50px");var t=d3.hierarchy(Diagram3Data).sum(function(t){return t.num}).sort(function(t,a){return a.num-t.num}),a=d3.treemap().tile(d3.treemapSquarify).size([c.width,c.height]).padding(1).round(!0)(t),e=c.svg.selectAll("g").data(a.leaves()).enter().append("g").attr("transform",function(t){return"translate("+t.x0+","+t.y0+")"});return e.append("rect").attr("fill",function(t,a){return 0===a?"#ff516f":d3.interpolateBlues(c.scale_color(a))}).transition().duration(c.duration).delay(function(t,a){return a*c.duration_delay}).attr("width",function(t){return t.x1-t.x0}).attr("height",function(t){return t.y1-t.y0}),e.append("text").attr("fill","#fff").attr("text-anchor","middle").style("font-size","18px").html(function(t,a){if(a<28){var e=t.data.name.split(" "),r=e.length,n="",i=t.x1-t.x0,s=0;if(e.forEach(function(t){s=c.getTxtLen(t)>s?c.getTxtLen(t):s}),s<=i){switch(r){case 1:n+='<tspan dy="0.5em" x="'+(t.x1-t.x0)/2+'">'+e[0]+"</tspan>";break;case 2:n+='<tspan dy="0em" x="'+(t.x1-t.x0)/2+'">'+e[0]+"</tspan>",n+='<tspan dy="1em" x="'+(t.x1-t.x0)/2+'">'+e[1]+"</tspan>";break;case 3:n+='<tspan dy="-0.5em" x="'+(t.x1-t.x0)/2+'">'+e[0]+"</tspan>",n+='<tspan dy="1em" x="'+(t.x1-t.x0)/2+'">'+e[1]+"</tspan>",n+='<tspan dy="1em" x="'+(t.x1-t.x0)/2+'">'+e[2]+"</tspan>"}return n}return""}}).attr("opacity",0).transition().duration(c.duration).delay(function(t,a){return a*c.duration_delay}).attr("opacity",1).attr("x",function(t){return(t.x1-t.x0)/2}).attr("y",function(t){return(t.y1-t.y0)/2}),isMobile.any?e.on("touchend",function(t){c.tooltip.html(function(){return'<p class="head mrb-name">'+t.data.name+'</p>                        <p class="head mrb-num">'+c.formatNum(t.data.num)+"</p>"}),c.tooltip.style("display","block");var a=c.tooltip.node().getBoundingClientRect();if(0!==a.width){var e=d3.event.changedTouches[0].pageX,r=d3.event.changedTouches[0].pageY,n=document.body.getBoundingClientRect();e+a.width>n.right&&(e-=e+a.width-n.right),e<0&&(e=0),r<0&&(r=0),c.tooltip.style("left",e+"px").style("top",r+"px")}}):e.on("mouseover",function(t){c.tooltip.html(function(){return'<p class="head mrb-name">'+t.data.name+'</p>                        <p class="head mrb-num">'+c.formatNum(t.data.num)+"</p>"}),c.tooltip.style("display","block")}).on("mousemove",function(t){var a=c.tooltip.node().getBoundingClientRect();if(0!==a.width){var e=d3.event.pageX,r=d3.event.pageY,n=document.body.getBoundingClientRect();e+a.width>n.right&&(e-=e+a.width-n.right),e<0&&(e=0),r<0&&(r=0),c.tooltip.style("left",e+"px").style("top",r+"px")}}).on("mouseout",function(t){c.tooltip.html(""),c.tooltip.style("display","none")}),c},MrbDiagram3.prototype.formatNum=function(t){return t.toString().replace(/\d+/,function(t){return t.replace(/(\d)(?=(\d{3})+$)/g,function(t){return t+","})})},MrbDiagram3.prototype.getTxtLen=function(t){return 8*t.length};var mrb_diagram_3=new MrbDiagram3;function MrbDiagram4(){this.width=700,this.height=700,this.svg=d3.select("#diagram4 svg"),this.wrap_circle_r=this.width/2-20,this.inner_circle_r=20,this.bar_w_gap=12,this.bar_w=16,this.scale_angle=d3.scaleLinear().domain([0,7]).range([0,2*Math.PI]),this.entries=d3.nest().key(function(t){return t.year}).sortValues(function(t,a){return t.word_index-a.word_index}).entries(Diagram4Data),this.duration=1200}MrbDiagram4.prototype.draw=function(){var o=this;isMobile.any?$("#diagram4").css("margin","317px 0 0 25px"):$("#diagram4").css("margin","25px 0 0 265px");var e=o.svg.attr("width",o.width).attr("height",o.height).append("g").attr("transform","translate("+o.width/2+","+o.height/2+")"),t=d3.arc().innerRadius(o.wrap_circle_r-1).outerRadius(o.wrap_circle_r).startAngle(0).endAngle(o.scale_angle(6));e.append("path").attr("d",t).attr("fill","#dad8dc"),t.innerRadius(o.inner_circle_r-1).outerRadius(o.inner_circle_r),e.append("path").attr("d",t).attr("fill","#dad8dc"),function(){for(var t=0;t<7;t++){var a=o.scale_angle(t)-Math.PI/2;e.append("line").attr("stroke","#dad8dc").attr("stroke-width",1).attr("x1",function(){return(o.inner_circle_r-1)*Math.cos(a)}).attr("y1",function(){return(o.inner_circle_r-1)*Math.sin(a)}).attr("x2",function(){return(o.wrap_circle_r+10)*Math.cos(a)}).attr("y2",function(){return(o.wrap_circle_r+10)*Math.sin(a)})}}();var a,r,n,i,d,s,l,c,p,u=d3.scaleLinear().domain([0,o.entries[0].values.length-1]).range([o.wrap_circle_r-o.bar_w_gap,o.inner_circle_r+o.bar_w_gap]);return(a=o.svg.append("g").attr("transform","translate("+o.width/2+","+o.height/2+")").selectAll("g").data(o.entries[0].values).enter().append("g").attr("transform",function(t,a){return"translate(0,"+-1*u(a)+")"})).append("line").attr("stroke","#dad8dc").attr("stroke-width",1).attr("x2",-5).attr("y2",0),a.append("text").attr("text-anchor","end").style("font-size","20px").attr("x",-8).attr("y","0.3em").attr("fill",function(t,a){return 0==a?"#f00":"#626064"}).text(function(t,a){return t.word}),r=o.svg.append("g").attr("transform","translate("+o.width/2+","+o.height/2+")"),n=o.scale_angle(1)/2-Math.PI/2,r.selectAll("g").data(o.entries).enter().append("g").attr("transform",function(t,a){var e=o.scale_angle(a)+n;return"translate("+o.wrap_circle_r*Math.cos(e)+","+o.wrap_circle_r*Math.sin(e)+")"}).append("text").attr("text-anchor","middle").attr("y","0").style("font-style","italic").attr("transform",function(t,a){return"rotate("+360/(2*Math.PI)*o.scale_angle(a+.5)+")"}).text(function(t){return t.key}),i=o.svg.append("g").attr("transform","translate("+o.width/2+","+o.height/2+")"),d=[1954,1978,1993,2009,2014,2018],s=d3.arc(),l=d3.scaleLinear().domain([0,50]).range([0,o.scale_angle(1)]),c=o.entries[0].values.length-1,p=d3.scaleLinear().domain([0,1]).range([.2,.8]),i.selectAll("path").data(Diagram4Data).enter().append("path").attr("data-numid",function(t,a){return"#d4_bar_num_"+a}).attr("fill",function(t,a){var e=t.word_index/c;return d3.interpolateSpectral(p(e))}).attr("data-fill",function(t,a){var e=t.word_index/c;return d3.interpolateSpectral(p(e))}).on("mouseenter",function(t){$($(this).data("numid")).removeClass("hide"),$(this).attr("fill","#ddd")}).on("mouseleave",function(t){$($(this).data("numid")).addClass("hide"),$(this).attr("fill",$(this).data("fill"))}).transition().duration(o.duration).attrTween("d",function(a,t){return function(t){return s.innerRadius(u(a.word_index)-o.bar_w/2).outerRadius(u(a.word_index)+o.bar_w/2).startAngle(o.scale_angle(d.indexOf(a.year))).endAngle(o.scale_angle(d.indexOf(a.year))+l(a.num)*t),s()}}),i.selectAll("g").data(Diagram4Data).enter().append("g").attr("transform",function(t,a){var e=o.scale_angle(d.indexOf(t.year))+l(t.num)+.01,r=o.scale_angle(d.indexOf(t.year))+l(45);r<e&&(e=r);var n=e-Math.PI/2,i=u(t.word_index),s=i*Math.cos(n),c=i*Math.sin(n);return t.angle=e,"translate("+s+","+c+")"}).append("text").attr("id",function(t,a){return"d4_bar_num_"+a}).attr("class","transition hide").style("font-size","16px").attr("fill","#646263").attr("y","0.4em").attr("transform",function(t,a){return"rotate("+360/(2*Math.PI)*t.angle+")"}).text(function(t,a){return 0<t.num?t.num:""}),o};var mrb_diagram_4=new MrbDiagram4;function MrbDiagram5(){this.width=isMobile.any?700:1e3,this.height=isMobile.any?800:500,this.svg=d3.select("#diagram5 svg"),this.scale_axis=d3.scaleLinear().domain([0,16]).range([0,this.height]),this.scale_line=d3.scaleLinear().domain([0,10]).range([0,this.width/2]),this.bar_x=0,this.bar_h=this.scale_axis(1),this.scale_bar_w=d3.scaleLinear().domain([0,60]).range([0,this.width/2]),this.bars_g=null,this.text_g=null,this.num_g=null,this.color_scale=d3.scaleLinear().domain([0,1]).range([.2,.6]),this.curr_year=null,this.init=null}MrbDiagram5.prototype.draw=function(){var e=this;return isMobile.any?($("#diagram5").css({left:"25px",top:"295px"}),$("#diagram5 .d5-title").addClass("m")):$("#diagram5").css({left:"140px",top:"150px"}),e.svg.attr("width",e.width).attr("height",e.height),e.svg.append("g").attr("transform","translate("+e.width/2+",0)").selectAll("line").data([1,2,3,4,5,6,7,8,9,10,11]).enter().append("line").attr("stroke","#eee").attr("stroke-width",1).attr("x1",function(t,a){return e.scale_line(a)}).attr("y1",function(){return 0}).attr("x2",function(t,a){return e.scale_line(a)}).attr("y2",function(){return e.height}),e.bars_g=e.svg.append("g").attr("transform","translate("+e.width/2+",0)"),e.text_g=e.svg.append("g").attr("transform","translate("+e.width/2+",0)"),e.num_g=e.svg.append("g").attr("transform","translate("+e.width/2+",0)"),e},MrbDiagram5.prototype.drawYearData=function(t){var r=this;if(r.curr_year!==t&&r.bars_g&&r.text_g){r.curr_year=t,console.log("draw",t),$("#diagram5_year").html(t);var n=Diagram5Data[t].length,a=Diagram5Data[t].sort(function(t,a){return a.num-t.num}),e=(d=r.bars_g.selectAll("rect").data(a,function(t){return t})).enter(),i=d.exit();d.transition().duration(1e3).attr("width",function(t,a){return r.scale_bar_w(t.num)}),e.append("rect").attr("x",function(t,a){return 0}).attr("y",function(t,a){return r.scale_axis(2*(a+1)-1)-r.bar_h/2}).attr("height",function(t,a){return r.bar_h}).attr("fill",function(t,a){var e=a/n;return d3.interpolateSpectral(r.color_scale(e))}).transition().duration(1e3).attr("width",function(t,a){return r.scale_bar_w(t.num)}),i.transition().duration(300).attr("width",function(){return 0}).remove();var s=r.text_g.selectAll("text").data(a),c=s.enter(),o=s.exit();s.attr("text-anchor","end").style("font-size","32px").attr("x","-0.5em").attr("y",function(t,a){return r.scale_axis(2*(a+1)-1)+10}).html(function(t,a){if(!isMobile.any)return t.word;switch(t.word){case"development models & problems":return'<tspan x="-0.3em" dy="-0.5em">development</tspan>                                <tspan x="-0.5em" dy="1em">models & problems</tspan>';case"national defense & foreign affairs":return'<tspan x="-0.3em" dy="-0.5em">national defense &</tspan>                                <tspan x="-0.5em" dy="1em">foreign affairs</tspan>';default:return t.word}}),c.append("text").attr("text-anchor","end").style("font-size","32px").attr("x","-0.5em").attr("y",function(t,a){return r.scale_axis(2*(a+1)-1)+10}).html(function(t,a){if(!isMobile.any)return t.word;switch(t.word){case"development models & problems":return'<tspan x="-0.3em" dy="-0.5em">development</tspan>                                <tspan x="-0.5em" dy="1em">models & problems</tspan>';case"national defense & foreign affairs":return'<tspan x="-0.3em" dy="-0.5em">national defense &</tspan>                                <tspan x="-0.5em" dy="1em">foreign affairs</tspan>';default:return t.word}}),o.transition().duration(300).style("opacity",function(){return 0}).remove();var d;e=(d=r.num_g.selectAll("text").data(a,function(t){return t})).enter(),i=d.exit();d.text(function(t,a){return t.num}).style("font-size","28px").transition().duration(1e3).attr("x",function(t,a){return r.scale_bar_w(t.num)+5}),e.append("text").attr("y",function(t,a){return r.scale_axis(2*(a+1)-1)+10}).attr("fill","#000000").text(function(t,a){return t.num}).style("font-size","28px").transition().duration(1e3).attr("x",function(t,a){return r.scale_bar_w(t.num)+5}),i.transition().duration(300).attr("opacity",function(){return 0}).remove()}return r},MrbDiagram5.prototype.barPathGen=function(t,a){var e=this,r=e.scale_axis(2*a-1),n=e.bar_h/2,i=e.scale_bar_w(t);return"M"+(e.bar_x+","+(r-n))+"L"+(i+","+(r-n))+"L"+(i+","+(r+n))+"L"+(e.bar_x+","+(r+n))+"Z"};var mrb_diagram_5=new MrbDiagram5;